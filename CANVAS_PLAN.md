# Logseq Whiteboard (ç™½æ¿) åŠŸèƒ½è®¾è®¡æ–¹æ¡ˆ v1.1

## ä¸€ã€èƒŒæ™¯ä¸ç›®æ ‡

### 1.1 æ ¸å¿ƒç›®æ ‡
æ‰“é€  Logseq åŸç”Ÿçš„ã€æ”¯æŒæ·±åº¦åµŒå¥—å’Œå¯Œåª’ä½“çš„è§†è§‰åŒ–çŸ¥è¯†ç®¡ç†æ¨¡å—ï¼Œå¯¹æ ‡ Heptabase å’Œ Obsidian Canvasï¼Œè§£å†³åŸ "Whiteboard" åŠŸèƒ½ç¼ºå¤±åŠæ’ä»¶é›†æˆåº¦ä½çš„é—®é¢˜ã€‚

### 1.2 å…³é”®ç—›ç‚¹è§£å†³
| ç—›ç‚¹ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| **ç™½æ¿æ— æ³•åµŒå¥—** | æ”¯æŒ **å­ç™½æ¿ (Nested Whiteboards)**ï¼Œæ„å»ºå±‚çº§åŒ–çŸ¥è¯†åº“ |
| **å†…å®¹é›¶æ•£** | æ”¯æŒ **Section (åŒºåŸŸ/åˆ†ç»„)**ï¼Œå¯è§†åŒ–ç»„ç»‡å¡ç‰‡ |
| **åª’ä½“ä½“éªŒå·®** | æ”¯æŒ **YouTube/è§†é¢‘ç›´æ¥æ’­æ”¾**ï¼Œç½‘é¡µé“¾æ¥å¯Œåª’ä½“é¢„è§ˆ |
| **ä¸­æ–‡å­—ä½“ä¸‘** | æºç çº§é›†æˆ **ä¸­æ–‡æ‰‹å†™å­—ä½“** |
| **å…¥å£éš¾æ‰¾** | ä¸»ç•Œé¢ **Journals ä¸‹æ–¹** å¢è®¾ä¸€çº§å…¥å£ "Whiteboards (ç™½æ¿)" |

---

## äºŒã€äº§å“åŠŸèƒ½è®¾è®¡

### 2.1 åŠŸèƒ½å±‚çº§ (Priority)

#### P0 - æ ¸å¿ƒä½“éªŒ (MVP)
- [ ] **Whiteboard å…¥å£**ï¼šä¾§è¾¹æ  "Journals" ä¸‹æ–¹æ–°å¢ "Whiteboards" (ä¸­æ–‡ï¼šç™½æ¿)ã€‚
- [ ] **æ— é™ç”»å¸ƒ**ï¼šåŸºäº tldraw 2.x çš„é«˜æ€§èƒ½æ— é™ç”»å¸ƒã€‚
- [ ] **Block/Page åµŒå…¥**ï¼šæ‹–æ‹½ Logseq èŠ‚ç‚¹/é¡µé¢åˆ°ç”»å¸ƒï¼Œå®æ—¶åŒå‘åŒæ­¥ã€‚
- [ ] **Section (åŒºåŸŸ)**ï¼šåˆ›å»ºå¯è§†åŒ–çš„åˆ†ç»„åŒºåŸŸï¼ˆå¸¦æ ‡é¢˜ï¼‰ï¼Œæ‹–å…¥å†…å®¹è‡ªåŠ¨å¸é™„ã€‚
- [ ] **å­ç™½æ¿ (Nested Boards)**ï¼š
    - åœ¨ç”»å¸ƒä¸­åˆ›å»º"æ–°ç™½æ¿"èŠ‚ç‚¹ã€‚
    - åŒå‡»èŠ‚ç‚¹è¿›å…¥ä¸‹ä¸€çº§ç™½æ¿ã€‚
    - é¢åŒ…å±‘å¯¼èˆª (Root > Parent > Child) å¿«é€Ÿè¿”å›ã€‚
- [ ] **ä¸­æ–‡æ‰‹å†™ä½“**ï¼šå®Œç¾æ”¯æŒä¸­æ–‡æ‰‹ç»˜é£æ ¼æ¸²æŸ“ã€‚
- [ ] **å…¨å±€æœç´¢**ï¼š`CMD+K` å¯ç›´æ¥æœç´¢ç™½æ¿åç§°å¹¶è·³è½¬ã€‚

#### P1 - å†…å®¹å¢å¼º
- [ ] **å¯Œåª’ä½“åµŒå…¥**ï¼š
    - ç²˜è´´ YouTube é“¾æ¥ -> è‡ªåŠ¨è½¬ä¸ºæ’­æ”¾å™¨å¡ç‰‡ã€‚
    - ç²˜è´´ Bilibili é“¾æ¥ -> è‡ªåŠ¨è½¬ä¸ºæ’­æ”¾å™¨å¡ç‰‡ã€‚
    - ç²˜è´´ Twitter/X é“¾æ¥ -> æ˜¾ç¤ºæ¨æ–‡å¡ç‰‡ã€‚
- [ ] **è¿æ¥çº¿ (Arrows)**ï¼šæ”¯æŒ Label çš„åŒå‘è¿æ¥çº¿ï¼Œå»ºç«‹é€»è¾‘å…³ç³»ã€‚
- [ ] **åŒå‘é“¾æ¥ (Backlinks)**ï¼šç™½æ¿å†…å¼•ç”¨çš„ Pageï¼Œåœ¨ Page åº•éƒ¨æ˜¾ç¤º "Linked in Whiteboards"ã€‚

#### P2 - é«˜çº§åŠŸèƒ½
- [ ] **All Whiteboards è§†å›¾**ï¼šå¡ç‰‡æµæˆ–åˆ—è¡¨æ¨¡å¼ç®¡ç†æ‰€æœ‰ç™½æ¿ã€‚
- [ ] **å¯¼å‡º**ï¼šå¯¼å‡ºä¸º PNG/SVG/PDFã€‚
- [ ] **æ¨¡æ¿**ï¼šå†…ç½®æ€ç»´å¯¼å›¾ã€æµç¨‹å›¾ã€åº·å¥ˆå°”ç¬”è®°æ¨¡æ¿ã€‚

### 2.2 UI ä¸äº¤äº’è®¾è®¡

#### 2.2.1 ä¾§è¾¹æ å…¥å£
```
Logseq
â”œâ”€â”€ ğŸ“… Journals
â”œâ”€â”€ ğŸ¨ Whiteboards  <-- æ–°å¢å…¥å£ (ç‚¹å‡»è¿›å…¥ç™½æ¿åˆ—è¡¨/æœ€è¿‘ç¼–è¾‘)
â”œâ”€â”€ ğŸ§  Graph view
â”œâ”€â”€ ğŸ“‚ All pages
â””â”€â”€ ...
```

#### 2.2.2 ç”»å¸ƒç¼–è¾‘å™¨ UI
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ  Home > ğŸ“‚ Project A > ğŸ“ Brainstorm (é¢åŒ…å±‘å¯¼èˆª)      âš™ï¸ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”                                                     â”‚
â”‚ â”‚ ğŸ–±ï¸  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Section A â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ ğŸ”²  â”‚  â”‚                                          â”‚     â”‚
â”‚ â”‚ ğŸ–¼ï¸  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚
â”‚ â”‚ ğŸ“  â”‚  â”‚  â”‚  Page A  â”‚   â”‚   YouTube Video  â”‚     â”‚     â”‚
â”‚ â”‚ ğŸ”—  â”‚  â”‚  â”‚ (Preview)â”‚   â”‚     [Player]     â”‚     â”‚     â”‚
â”‚ â”‚ ğŸ¨  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚
â”‚ â”‚     â”‚  â”‚                                          â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                     â”‚                       â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â–¼                       â”‚
â”‚           â”‚  Sub-Board   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚           â”‚  (Double     â”‚    â”‚   Block    â”‚            â”‚
â”‚           â”‚   Click)     â”‚    â”‚  Content   â”‚            â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Zoom: 100% | Undo/Redo | Help                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2.3 äº¤äº’ç»†èŠ‚
*   **Create Section**: ç±»ä¼¼ Heptabaseï¼Œé•¿æŒ‰é¼ æ ‡å³é”®æ¡†é€‰æˆ–ä½¿ç”¨å·¥å…·æ  "Section" å·¥å…·ï¼Œåˆ›å»ºä¸€ä¸ªå¸¦èƒŒæ™¯è‰²çš„å®¹å™¨ï¼Œç§»åŠ¨ Section æ—¶å†…éƒ¨å…ƒç´ éšåŠ¨ã€‚
*   **å­ç™½æ¿**: ç”»å¸ƒä¸Šæ˜¾ç¤ºä¸ºå¡ç‰‡æ ·å¼ï¼ˆæ˜¾ç¤ºæ ‡é¢˜+ç¼©ç•¥å›¾ï¼‰ï¼ŒåŒå‡»è¿›å…¥è¯¥ç™½æ¿è§†å›¾ï¼Œé¡¶æ æ˜¾ç¤ºé¢åŒ…å±‘è·¯å¾„ä»¥ä¾¿è¿”å›ã€‚
*   **åª’ä½“ç²˜è´´**: ä¾¦æµ‹å‰ªè´´æ¿å†…å®¹ï¼Œå¦‚æœæ˜¯ YouTube URLï¼Œè‡ªåŠ¨åˆ›å»º `EmbedShape` è€Œä¸æ˜¯ `TextShape`ã€‚

---

## ä¸‰ã€æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 3.1 æ ¸å¿ƒæŠ€æœ¯é€‰å‹
*   **å¼•æ“**: `@tldraw/tldraw` (v2.x) - æ€§èƒ½å¥½ï¼Œæ¶æ„çµæ´»ï¼Œæ”¯æŒè‡ªå®šä¹‰ Shapeã€‚
*   **çŠ¶æ€ç®¡ç†**: Logseq DB (DataScript) + tldraw Storeã€‚
*   **åª’ä½“æ”¯æŒ**: tldraw åŸç”Ÿ `EmbedShape` + è‡ªå®šä¹‰ URL è§£æé€»è¾‘ã€‚

### 3.2 æ•°æ®ç»“æ„è®¾è®¡ (DataScript)

```clojure
;; 1. ç™½æ¿ä½œä¸ºä¸€ç§ç‰¹æ®Šçš„ Page
:logseq.class/Whiteboard
{:title "Whiteboard"
 :properties {:logseq.property.class/extends :logseq.class/Page
              :logseq.property/icon "ğŸ¨"} ;; é»˜è®¤å›¾æ ‡
 :schema {:properties [:logseq.property.whiteboard/data
                       :logseq.property.whiteboard/snapshot]}}

;; 2. ç™½æ¿æ•°æ®å­˜å‚¨ (Blob/EDN)
:logseq.property.whiteboard/data
{:title "Canvas Data"
 :schema {:type :map :hide? true}} 
 ;; å­˜å‚¨ tldraw çš„ JSON æ•°æ®ï¼ŒåŒ…å« shapes, bindings, assets

;; 3. è‡ªå®šä¹‰ Shape å®šä¹‰ (æ‰©å±• tldraw)
;; - "logseq-portal": ç”¨äºå­ç™½æ¿è·³è½¬
;; - "logseq-block": ç”¨äº Logseq Block æ¸²æŸ“
;; - "logseq-page": ç”¨äº Logseq Page é¢„è§ˆ
```

### 3.3 å…³é”®åŠŸèƒ½å®ç°é€»è¾‘

#### A. å®ç° "Section" (åˆ†ç»„)
åˆ©ç”¨ tldraw çš„ `Frame` æˆ– `Group` æ¦‚å¿µï¼Œä½†åœ¨ Logseq ä¸­æˆ‘ä»¬å®šåˆ¶ä¸º `SectionShape`ã€‚
*   **è¡Œä¸º**: å…·æœ‰ z-index å±‚çº§ï¼Œä½äºåº•éƒ¨ã€‚ç§»åŠ¨ Section æ—¶ï¼Œè®¡ç®—åŒ…å›´ç›’å†…çš„æ‰€æœ‰å…¶ä»– Shapes å¹¶åŒæ­¥ç§»åŠ¨ã€‚
*   **æ ·å¼**: æ”¯æŒè‡ªå®šä¹‰èƒŒæ™¯è‰²ã€æ ‡é¢˜æ é¢œè‰²ã€‚

#### B. å®ç° "å­ç™½æ¿" (Nested Whiteboards)
*   **æ•°æ®**: æ˜¯ä¸€ä¸ªæŒ‡å‘å¦ä¸€ä¸ª `:logseq.class/Whiteboard` Page çš„é“¾æ¥ Shapeã€‚
*   **äº¤äº’**:
    *   **å•å‡»**: é€‰ä¸­ï¼Œæ˜¾ç¤ºå±æ€§ï¼ˆå¦‚é‡å‘½åï¼‰ã€‚
    *   **åŒå‡»**: è§¦å‘è·¯ç”±è·³è½¬ `route/push-state` åˆ‡æ¢åˆ°ç›®æ ‡ç™½æ¿ IDã€‚
*   **åˆ›å»º**: å·¥å…·æ  -> "New Sub-board" -> åœ¨ DB åˆ›å»ºæ–° Page -> åœ¨å½“å‰ç”»å¸ƒåˆ›å»ºå¼•ç”¨ Shapeã€‚

#### C. å¯Œåª’ä½“åµŒå…¥ (YouTube)
æ‰©å±• tldraw çš„ `Asset` å¤„ç†é€»è¾‘ï¼š
```typescript
// ä¼ªä»£ç é€»è¾‘
onPaste: (text) => {
  if (isYouTubeUrl(text)) {
    return createShape('embed', { 
      type: 'youtube', 
      url: text, 
      w: 640, h: 360 
    });
  }
}
```

#### D. å…¥å£èœå•ä¿®æ”¹
ä¿®æ”¹ `src/main/frontend/handler/left_sidebar.cljs`ï¼š
*   åœ¨ `Journals` å¯¹åº”çš„ DOM ç»“æ„ä¸‹æ–¹ï¼Œæ’å…¥ `Whiteboards` é“¾æ¥ã€‚
*   ç‚¹å‡»è§¦å‘ `:whiteboard/home` äº‹ä»¶ï¼Œæ˜¾ç¤ºç™½æ¿åˆ—è¡¨ Dashboardã€‚

---

## å››ã€å¼€å‘è®¡åˆ’ (Roadmap)

### Phase 1: æ ¸å¿ƒå¼•æ“ä¸å…¥å£ (Week 1-2)
- [ ] å¼•å…¥ tldraw 2.x ä¾èµ–ã€‚
- [ ] **UI**: åœ¨å·¦ä¾§ Sidebar å®ç° "Whiteboards" å…¥å£ã€‚
- [ ] **UI**: å®ç°ç™½æ¿ Dashboardï¼ˆæ–°å»ºã€åˆ—è¡¨ï¼‰ã€‚
- [ ] **Core**: å®ç°åŸºç¡€ç”»å¸ƒç¼–è¾‘ã€ä¿å­˜æ•°æ®åˆ° DBã€‚
- [ ] **Font**: é›†æˆä¸­æ–‡æ‰‹å†™å­—ä½“ (ZCOOL KuaiLe)ã€‚

### Phase 2: æ·±åº¦é›†æˆä¸åµŒå¥— (Week 3-4)
- [ ] **Feature**: å®ç° Block/Page æ‹–æ‹½ä¸Šå±ã€‚
- [ ] **Feature**: å®ç° **Section** åŠŸèƒ½ã€‚
- [ ] **Feature**: å®ç° **å­ç™½æ¿** åˆ›å»ºä¸è·³è½¬äº¤äº’ï¼ˆé¢åŒ…å±‘ï¼‰ã€‚
- [ ] **Feature**: åª’ä½“é“¾æ¥è‡ªåŠ¨è½¬ Embed Playerã€‚

### Phase 3: ä¼˜åŒ–ä¸æœç´¢ (Week 5)
- [ ] **Search**: é›†æˆ CMD+K æœç´¢ã€‚
- [ ] **Perf**: å¤§æ•°æ®é‡æ€§èƒ½ä¼˜åŒ–ã€‚
- [ ] **Export**: å¯¼å‡ºåŠŸèƒ½ã€‚

---

## äº”ã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç¡®è®¤æ–¹æ¡ˆ**: å®¡æ ¸æœ¬è®¾è®¡æ–‡æ¡£ã€‚
2. **ç¯å¢ƒå‡†å¤‡**: ç¡®ä¿æœ¬åœ° `yarn install` æˆåŠŸï¼Œå®‰è£… `@tldraw/tldraw`ã€‚
3. **åŸå‹å¼€å‘**: å…ˆå®ç° "Whiteboards" ä¾§è¾¹æ å…¥å£ï¼Œç‚¹å‡»åæ¸²æŸ“ä¸€ä¸ªç©ºçš„ tldraw ç”»å¸ƒã€‚
